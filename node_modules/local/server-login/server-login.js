'use strict';

var TokenGenerator = require('firebase-token-generator'),
    firebaseAuth = require('local/repositories/firebase-auth'),
    q = require('q');

var deferred;

function login(id, secret) {

    if (!deferred) {
        deferred = new q.defer();
        var gen = new TokenGenerator(secret);

        var token = gen.createToken(
            { uid: id },
            { admin: true });

        firebaseAuth.loginWithFirebase(token).then(function (result) {
            deferred.resolve(result);
        }).fail(function (err) {
            deferred.reject(err);
        });
    }
    return deferred.promise;
};

module.exports = login;